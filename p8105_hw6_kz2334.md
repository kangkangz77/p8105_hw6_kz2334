p8105\_hw6\_kz2334
================
Kangkang Zhang

Load required packages.

Problem 1
---------

Import the data.

``` r
homicide_data = read_csv("./data/homicide-data.csv")
```

Create a city\_state variable, and a binary variable indicating whether the homicide is solved.

``` r
homicide_data = homicide_data %>% 
  mutate(city_state = str_c(city, ", ", state),
         status = ifelse(disposition %in% c("Closed without arrest", "Open/No arrest"), 0, 1))
```

Omit cities Dallas, TX; Phoenix, AZ; Kansas City, MO and Tulsa, AL. Modifiy victim\_race to have categories white and non-white, with white as the reference category. Convert victim\_age to numeric.

``` r
homicide_md = homicide_data %>% 
  filter(!(city_state %in% c("Dallas, TX", "Phoenix, AZ", "Kansas City, MO", "Tulsa, AL"))) %>% 
  mutate(victim_race = ifelse(victim_race == "White", "white", "non-white"),
         victim_race = as.factor(victim_race), 
         victim_race = relevel(victim_race, ref = "white"),
          victim_age = as.numeric(victim_age))
  
```

------------------------------------------------------------------------

Run logistic regression for the city of Baltimore, MD. Find out the CI and estimate of the adjusted odds ratio for solving homicides comparing non-white victims to white victims keeping all other variables fixed.

``` r
balt_logistic = homicide_md %>% 
  filter(city_state == "Baltimore, MD") %>% 
  glm(status ~ victim_age + victim_sex + victim_race, data = ., family = binomial())

balt_logistic %>% 
  broom::tidy() %>%
  #extract OR and CIs for OR
  mutate(OR = exp(estimate),
    conf_low_or = exp(confint(balt_logistic, level = 0.95)[,1]),
    conf_high_or = exp(confint(balt_logistic, level = 0.95)[,2])) %>% 
  filter(term == "victim_racenon-white") %>% 
  select(OR, starts_with("conf")) %>% 
  knitr::kable(digit = 3)
```

|     OR|  conf\_low\_or|  conf\_high\_or|
|------:|--------------:|---------------:|
|  0.441|          0.312|            0.62|

We can see that adjusted OR for solving homicides comparing non-white victims to white victims in Baltimore is 0.441. 95% CI is (0.312, 0.620). The OR solving homicides for non-white victims is 0.441 times of that for white victims, which means non-white victims are less likely to be with solving homicides.

------------------------------------------------------------------------

Run glm for each of the cities, and extract the adjusted odds ratio (and CI) for solving homicides comparing non-white victims to white victims. Create a dataframe with estimated ORs and CIs for each city.

``` r
homicide_md %>% 
  group_by(city_state) %>% 
  nest() %>%
  #run glm, extract estimates and CIs
  mutate(logistic = map(data, ~glm(status ~ victim_age + victim_sex + victim_race, 
                                   data = .x, family = binomial())),
         result = map(logistic, broom::tidy),
         conf = map(logistic, confint), 
         result_comb = map2(result, conf, cbind)) %>%
  select(city_state, result_comb) %>% 
  unnest() %>%
  filter(term == "victim_racenon-white") %>%
  janitor::clean_names() %>%
  #calculate OR and CIs
  mutate(OR = exp(estimate),
    conf_low_or = exp(x2_5_percent),
    conf_high_or = exp(x97_5_percent)) %>% 
  select(city_state, OR, starts_with("conf")) %>% 
  knitr::kable(digit = 3)
```

| city\_state        |     OR|  conf\_low\_or|  conf\_high\_or|
|:-------------------|------:|--------------:|---------------:|
| Albuquerque, NM    |  0.741|          0.449|           1.215|
| Atlanta, GA        |  0.753|          0.424|           1.299|
| Baltimore, MD      |  0.441|          0.312|           0.620|
| Baton Rouge, LA    |  0.668|          0.304|           1.405|
| Birmingham, AL     |  1.039|          0.612|           1.754|
| Boston, MA         |  0.115|          0.043|           0.259|
| Buffalo, NY        |  0.390|          0.210|           0.710|
| Charlotte, NC      |  0.558|          0.313|           0.951|
| Chicago, IL        |  0.562|          0.432|           0.734|
| Cincinnati, OH     |  0.318|          0.180|           0.541|
| Columbus, OH       |  0.855|          0.634|           1.153|
| Denver, CO         |  0.602|          0.358|           1.008|
| Detroit, MI        |  0.651|          0.487|           0.869|
| Durham, NC         |  1.003|          0.390|           2.452|
| Fort Worth, TX     |  0.838|          0.553|           1.264|
| Fresno, CA         |  0.448|          0.222|           0.846|
| Houston, TX        |  0.873|          0.698|           1.090|
| Indianapolis, IN   |  0.505|          0.381|           0.665|
| Jacksonville, FL   |  0.658|          0.502|           0.862|
| Las Vegas, NV      |  0.755|          0.586|           0.972|
| Long Beach, CA     |  0.794|          0.379|           1.606|
| Los Angeles, CA    |  0.666|          0.481|           0.916|
| Louisville, KY     |  0.392|          0.257|           0.590|
| Memphis, TN        |  0.782|          0.519|           1.160|
| Miami, FL          |  0.576|          0.377|           0.881|
| Milwaukee, wI      |  0.632|          0.398|           0.982|
| Minneapolis, MN    |  0.646|          0.341|           1.204|
| Nashville, TN      |  0.899|          0.652|           1.234|
| New Orleans, LA    |  0.466|          0.294|           0.737|
| New York, NY       |  0.531|          0.271|           0.988|
| Oakland, CA        |  0.213|          0.099|           0.418|
| Oklahoma City, OK  |  0.681|          0.477|           0.970|
| Omaha, NE          |  0.169|          0.091|           0.298|
| Philadelphia, PA   |  0.644|          0.485|           0.850|
| Pittsburgh, PA     |  0.282|          0.157|           0.485|
| Richmond, VA       |  0.447|          0.144|           1.150|
| San Antonio, TX    |  0.689|          0.459|           1.026|
| Sacramento, CA     |  0.781|          0.443|           1.348|
| Savannah, GA       |  0.596|          0.275|           1.258|
| San Bernardino, CA |  0.880|          0.394|           1.999|
| San Diego, CA      |  0.483|          0.294|           0.778|
| San Francisco, CA  |  0.458|          0.288|           0.719|
| St. Louis, MO      |  0.577|          0.405|           0.819|
| Stockton, CA       |  0.376|          0.193|           0.713|
| Tampa, FL          |  1.159|          0.585|           2.293|
| Tulsa, OK          |  0.602|          0.411|           0.876|
| Washington, DC     |  0.510|          0.250|           0.989|
